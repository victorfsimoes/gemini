<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:comp="http://java.sun.com/jsf/composite/componentes">

<ui:composition template="/templates/layoutBasico.xhtml">

	<ui:define name="content">

		<ui:param name="novoTicket" value="#{ticketMB.ticket}" />
		<ui:param name="novoTicketDet" value="#{ticketMB.ticketDetalhe}" />
		<ui:param name="historicoTickets" value="#{ticketMB.tickets}" />

		<p:panel styleClass="panelTransparente" id="panelContainerTicket">

			<h1 class="tituloPags1">#{msg['titulo.atendimento']}</h1>


			<h:form id="formTicket" style="padding-top:20px; text-align: left">

				<p:fieldset legend="#{msg['acao.abrirNovoTicket']}" id="novoTicket"
					collapsed="#{not(historicoTickets == null or historicoTickets.size() == 0)}"
					toggleable="true" toggleSpeed="500">

					<h:panelGrid columns="2" id="novoTicketTopicoAssunto">
						<comp:comboBox titulo="#{msg['texto.topico']}" value="#{novoTicket.topicoCodigo}"
							lista="#{ticketMB.topicosTicket}" var="tt"
							itemLabel="#{tt.descricao}" itemValue="#{tt.codigo}"
							update=":formTicket:novoTicketTopicoAssunto" />
						<comp:comboBox titulo="#{msg['texto.assunto']}"
							value="#{novoTicket.assuntoCodigo}"
							lista="#{ticketMB.getAssuntosPorTopico(novoTicket.topicoCodigo)}"
							var="at" itemValue="#{at.codigo}" itemLabel="#{at.descricao}" />

					</h:panelGrid>

					<h:outputText value="#{msg['texto.escrevaDuvidasSugestoes']}"
						style="text-align:left; display:block;" />
					<p:inputTextarea style="width:90%; display:block;"
						value="#{novoTicketDet.mensagem}" />

					<p:commandButton value="#{msg['acao.enviar']}" update="formTicket:novoTicket, formTicket:historicoTickets"
						actionListener="#{ticketMB.enviarTicket(novoTicket, true)}" />

				</p:fieldset>

				<br />
				<br />

				<p:fieldset legend="#{msg['titulo.historicoAtendimentos']}" id="historicoTickets"
					rendered="#{not (historicoTickets == null) and (historicoTickets.size() > 0)}">

					<div style="border: dashed silver 2px; padding: 10px">

						<h:outputText value="#{msg['acao.filtrar']}"
							style="display: inline-block; vertical-align:top; background: rgb(240,230,140); padding:10px; margin: 0 !important; text-weight: bold" />

						<div style="display: inline-block; vertical-align: middle;">

							<h:panelGrid columns="5">
								<h:outputText value="#{msg['texto.data']}:" styleClass="bold" />
								<h:outputText value="#{msg['texto.de']}"
									style="text-transform: lowercase" />
								<p:calendar locale="pt" yearRange="c-23:c+2" navigator="true"
									id="ptCal" showButtonPanel="true" pattern="dd/MM/yyyy" />
								<h:outputText value="#{msg['texto.a']}" />
								<p:calendar locale="pt" navigator="true" yearRange="c-23:c+2"
									pattern="dd/MM/yyyy" />
							</h:panelGrid>

						</div>

					</div>

					<p:accordionPanel value="#{ticketMB.tickets}"
						styleClass="accordionMeusPedidos" var="ticket"
						id="accordionTickets" dynamic="true">

						<p:ajax event="tabChange" global="false" update="accordionTickets"
							listener="#{ticketMB.historicoTicketsTabChange}" />

						<p:tab id="tab">
							<f:facet name="title">
								<div style="width: 100%; height: 20px; display: block">
									<h:outputText
										value="#{formatacaoMB.formataData(ticket.dataCadastro)} #{ticket.horaCadastro}"
										style="display:inline-block; width:15%;" />
									<h:outputText style="display:inline-block; width:35%;"
										value="#{ticketMB.nomearTopico(ticket.topicoCodigo)}: #{ticketMB.nomearAssunto(ticket.topicoCodigo, ticket.assuntoCodigo)}" />
									<h:outputText value="#{ticketMB.nomearStatus(ticket.status)}"
										style="display:inline-block; width:20%;" />
								</div>
							</f:facet>

							<p:dataGrid value="#{ticketMB.respostasTicket}" var="resposta">

								<div
									style="padding: 10px; width: 100%">

									<h:outputText value="#{resposta.mensagem}" />

									<h:outputText value="Voce. #{formatacaoMB.formataData(resposta.data)} #{resposta.hora}"
										style="padding-top:10px; display:block;" />

								</div>

							</p:dataGrid>
							
							



						</p:tab>

					</p:accordionPanel>



				</p:fieldset>
			</h:form>
		</p:panel>
	</ui:define>

</ui:composition>
</html>